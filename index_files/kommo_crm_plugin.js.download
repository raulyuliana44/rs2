!function(){"use strict";const e=async()=>{const e=await fetch("/cart.js");return await e.json()},t=e=>{let t,n=()=>{};const o=new Promise(((e,o)=>{t=e,n=o})),r=new XMLHttpRequest;return r.open("GET",`https://shpfintegration.kommo.com/api/v1/crm_plugin/script/${e}`),r.onload=function(){t(this.response)},r.onerror=function(){n()},r.send(),o},n=async e=>{const{userId:t,cartToken:n,shopId:o}=e;await fetch("https://shpfintegration.kommo.com/api/v1/contacts",{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({livechat_user_id:t,shopify_cart_token:n,shop_id:o})})};let o;const r=new Uint8Array(16);function i(){if(!o&&(o="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!o))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return o(r)}const c=[];for(let e=0;e<256;++e)c.push((e+256).toString(16).slice(1));var s={randomUUID:"undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};function a(e,t,n){if(s.randomUUID&&!t&&!e)return s.randomUUID();const o=(e=e||{}).random||(e.rng||i)();if(o[6]=15&o[6]|64,o[8]=63&o[8]|128,t){n=n||0;for(let e=0;e<16;++e)t[n+e]=o[e];return t}return function(e,t=0){return c[e[t+0]]+c[e[t+1]]+c[e[t+2]]+c[e[t+3]]+"-"+c[e[t+4]]+c[e[t+5]]+"-"+c[e[t+6]]+c[e[t+7]]+"-"+c[e[t+8]]+c[e[t+9]]+"-"+c[e[t+10]]+c[e[t+11]]+c[e[t+12]]+c[e[t+13]]+c[e[t+14]]+c[e[t+15]]}(o)}
/*! js-cookie v3.0.5 | MIT */function u(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)e[o]=n[o]}return e}var d=function e(t,n){function o(e,o,r){if("undefined"!=typeof document){"number"==typeof(r=u({},n,r)).expires&&(r.expires=new Date(Date.now()+864e5*r.expires)),r.expires&&(r.expires=r.expires.toUTCString()),e=encodeURIComponent(e).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape);var i="";for(var c in r)r[c]&&(i+="; "+c,!0!==r[c]&&(i+="="+r[c].split(";")[0]));return document.cookie=e+"="+t.write(o,e)+i}}return Object.create({set:o,get:function(e){if("undefined"!=typeof document&&(!arguments.length||e)){for(var n=document.cookie?document.cookie.split("; "):[],o={},r=0;r<n.length;r++){var i=n[r].split("="),c=i.slice(1).join("=");try{var s=decodeURIComponent(i[0]);if(o[s]=t.read(c,s),e===s)break}catch(e){}}return e?o[e]:o}},remove:function(e,t){o(e,"",u({},t,{expires:-1}))},withAttributes:function(t){return e(this.converter,u({},this.attributes,t))},withConverter:function(t){return e(u({},this.converter,t),this.attributes)}},{attributes:{value:Object.freeze(n)},converter:{value:Object.freeze(t)}})}({read:function(e){return'"'===e[0]&&(e=e.slice(1,-1)),e.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent)},write:function(e){return encodeURIComponent(e).replace(/%(2[346BF]|3[AC-F]|40|5[BDE]|60|7[BCD])/g,decodeURIComponent)}},{path:"/"});const p="kommo_crm_plugin_user_id";let m=!1,l=null;const f=e=>{const{userId:t,cartToken:o,shopId:r}=e,i={en:"SHOPIFY CART INTERACTION",es:"INTERACCIÃ“N CON EL CARRO DE SHOPIFY",pt:"INTERAÃ‡ÃƒO NO CARRINHO DO SHOPIFY"},c=()=>{crmPlugin("runStartMessagingFromShopify",`[${i[window.KOMMO_CRM_PLUGIN_LANG_ID||"en"]} ðŸ›ï¸ ðŸ›’]`);const e=l?.token;e&&o!==e&&setTimeout((()=>{n({userId:t,cartToken:o,shopId:r})}),100)};m?c():crmPlugin("onChatRenderDone",(()=>{c()}))};(async()=>{const[o,r]=await Promise.all([e(),t(KOMMO_CRM_PLUGIN.shopId)]);l=o;const i=(()=>{const e=d.get("amo-livechat-id");if(e)return e;let t=d.get(p);return t||(t=a(),d.set(p,t,{expires:365})),t})();if((e=>{window.crmPluginConfig={onlinechat:{user_id:e}}})(i),n({userId:i,cartToken:o.token,shopId:KOMMO_CRM_PLUGIN.shopId}),(e=>{const t=document.createElement("script");t.innerHTML=e,document.body.append(t)})(r),crm_plugin.setMeta({contact:{custom_fields:[{code:"SHOPIFY_CART_TOKEN",values:[{value:o.token}]},{code:"SHOPIFY_USER_ID",values:[{value:i}]}]}}),crmPlugin("onChatRenderDone",(()=>{m=!0})),o.items.length)f({userId:i,cartToken:o.token,shopId:KOMMO_CRM_PLUGIN.shopId});else{let t=0;const n=()=>performance.now()/1e3,o=async()=>{if(n()-t<5)requestAnimationFrame(o);else try{const r=await e();t=n(),r.items.length?f({userId:i,cartToken:r.token,shopId:KOMMO_CRM_PLUGIN.shopId}):(l=r,requestAnimationFrame(o))}catch(e){t=n(),requestAnimationFrame(o)}};requestAnimationFrame(o)}})()}();
